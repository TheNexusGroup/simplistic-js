<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simplistic Todo App</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
            min-height: 100vh;
        }
        
        * {
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <script type="module">
        import { app, h1, p, div, button, input } from '../src/simplistic.js'
        import { state, each } from '../src/state.js'

        app(() => {
            // App container
            div({ center: true, pad: [40, 20] },
                div({
                    width: 600,
                    bg: 'white',
                    rounded: 16,
                    shadow: true,
                    pad: 40
                },
                    // Header
                    h1('Todo App', { 
                        center: true,
                        color: '#1f2937',
                        margin: [0, 0, 30, 0]
                    }),
                    
                    // Todo state
                    (() => {
                        const todos = state([
                            { id: 1, text: 'Learn Simplistic', done: false },
                            { id: 2, text: 'Build something awesome', done: false },
                            { id: 3, text: 'Share with the world', done: true }
                        ])
                        
                        const filter = state('all') // all, active, done
                        
                        // Add todo input
                        const todoInput = input({
                            placeholder: 'What needs to be done?',
                            size: 'large',
                            width: '100%',
                            margin: [0, 0, 20, 0],
                            onEnter: (text) => {
                                if (text.trim()) {
                                    todos.push({
                                        id: Date.now(),
                                        text: text.trim(),
                                        done: false
                                    })
                                    todoInput.clear()
                                }
                            }
                        })
                        
                        // Filter buttons
                        div({ 
                            row: true, 
                            gap: 10, 
                            center: true,
                            margin: [0, 0, 20, 0]
                        },
                            ['all', 'active', 'done'].map(f =>
                                button(f.charAt(0).toUpperCase() + f.slice(1), {
                                    primary: filter.value === f,
                                    small: true,
                                    onClick: () => filter.value = f
                                })
                            )
                        )
                        
                        // Filtered todos computed state
                        const filteredTodos = todos.map(todoList => 
                            todoList.filter(todo => {
                                if (filter.value === 'active') return !todo.done
                                if (filter.value === 'done') return todo.done
                                return true
                            })
                        )
                        
                        // Todo list container
                        const todoContainer = div({
                            margin: [0, 0, 20, 0]
                        })
                        
                        // Update todo list when state changes
                        const updateTodos = () => {
                            // Clear container
                            todoContainer.innerHTML = ''
                            
                            const currentTodos = filteredTodos.value
                            
                            if (currentTodos.length === 0) {
                                const emptyMsg = p(
                                    filter.value === 'active' ? 'No active todos!' :
                                    filter.value === 'done' ? 'No completed todos!' :
                                    'No todos yet. Add one above!',
                                    {
                                        center: true,
                                        gray: true,
                                        italic: true,
                                        pad: 40
                                    }
                                )
                                todoContainer.appendChild(emptyMsg)
                                return
                            }
                            
                            currentTodos.forEach(todo => {
                                const todoEl = div({
                                    row: true,
                                    between: true,
                                    pad: 15,
                                    margin: [0, 0, 10, 0],
                                    bg: todo.done ? '#f0fdf4' : '#fafafa',
                                    border: todo.done ? '#22c55e' : '#e5e7eb',
                                    rounded: 8,
                                    hover: {
                                        bg: todo.done ? '#ecfdf5' : '#f5f5f5'
                                    }
                                },
                                    p(todo.text, { 
                                        strike: todo.done,
                                        color: todo.done ? '#16a34a' : '#374151'
                                    }),
                                    div({ row: true, gap: 10 },
                                        button(todo.done ? '↶ Undo' : '✓ Done', {
                                            small: true,
                                            primary: !todo.done,
                                            ghost: todo.done,
                                            onClick: () => {
                                                const todoList = todos.value
                                                const todoIndex = todoList.findIndex(t => t.id === todo.id)
                                                if (todoIndex !== -1) {
                                                    todoList[todoIndex].done = !todoList[todoIndex].done
                                                    todos.value = [...todoList] // Trigger reactivity
                                                }
                                            }
                                        }),
                                        button('✕', {
                                            small: true,
                                            onClick: () => {
                                                todos.value = todos.value.filter(t => t.id !== todo.id)
                                            }
                                        })
                                    )
                                )
                                todoContainer.appendChild(todoEl)
                            })
                        }
                        
                        // Subscribe to changes
                        todos.subscribe(updateTodos)
                        filter.subscribe(updateTodos)
                        
                        // Initial render
                        updateTodos()
                        
                        // Stats
                        const statsContainer = div({
                            row: true,
                            between: true,
                            pad: [20, 0, 0, 0],
                            border: '1px solid #e5e7eb',
                            borderWidth: '1px 0 0 0'
                        })
                        
                        const updateStats = () => {
                            const allTodos = todos.value
                            const activeTodos = allTodos.filter(t => !t.done)
                            const doneTodos = allTodos.filter(t => t.done)
                            
                            statsContainer.innerHTML = ''
                            
                            const leftStat = p(`${activeTodos.length} items left`, { small: true, gray: true })
                            const rightStat = p(`${doneTodos.length} completed`, { small: true, gray: true })
                            
                            statsContainer.appendChild(leftStat)
                            statsContainer.appendChild(rightStat)
                        }
                        
                        todos.subscribe(updateStats)
                        updateStats()
                        
                        return null // This function just sets up the todo app
                    })()
                )
            )
        })
    </script>
</body>
</html>